# Phase 2: コア機能実装（約1ヶ月）

**要件名**: MCPエディタ統合サーバー
**期間**: 2025年12月 - 2026年1月（25営業日、200時間）
**目標**: MCPサーバーの中核となるプロトコル層とアダプター層の実装

---

## タスク一覧

### Week 1: MCPサーバー基盤実装（5日間、40時間）

#### Day 26: MCPサーバーメインクラスの実装
- **タスクタイプ**: TDD 🔵
- **要件名**: MCPエディタ統合サーバー
- **要件リンク**: [技術設計書 §3.1](../design/technical-design.md#31-mcpサーバーコア)
- **推定工数**: 8時間
- **タスク**: MCPサーバーの基幹クラスを実装する
- **成果物**: `src/server/MCPServer.ts`
  - `IMCPServer` インターフェースの実装
  - `start()` / `stop()` メソッド
  - ツール登録機構
  - リクエスト受信処理
- **実装詳細**:
  - 設計書 §3.1 の MCPServer クラスを実装
  - JSON-RPC 2.0 プロトコルのハンドシェイク処理
  - ツール登録機構を Map で実装
  - stdio を使用したリクエスト受信処理
- **テスト要件**:
  - サーバー起動・停止のテスト
  - MCPプロトコルハンドシェイクのテスト
  - ツール登録・取得のテスト
  - エラーハンドリングのテスト
- **依存関係**: Phase 1 完了
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] サーバーが正常に起動・停止できること
  - [ ] MCPプロトコルのハンドシェイクが成功すること
  - [ ] 単体テストが作成されていること

---

#### Day 27: リクエストハンドラーの実装
- **タスクタイプ**: TDD 🔵
- **要件名**: MCPエディタ統合サーバー
- **要件リンク**: [技術設計書 §3.1.1](../design/technical-design.md#311-リクエストハンドラー)
- **推定工数**: 8時間
- **タスク**: MCP リクエストをルーティングするハンドラーを実装する
- **成果物**: `src/server/RequestHandler.ts`
  - リクエストのパース
  - ツールへのルーティング
  - エラーハンドリング
  - 監査ログの記録
- **実装詳細**:
  - 設計書 §3.1.1 の RequestHandler クラスを実装
  - JSON-RPC 2.0 仕様に従ったリクエストパース
  - ツールマップを使用したルーティング
  - 監査ログを winston で記録
- **テスト要件**:
  - JSON-RPCリクエストのパーステスト
  - ツールルーティングのテスト
  - 不正リクエストのエラーハンドリングテスト
  - 監査ログ記録のテスト
- **依存関係**: Day 26
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] JSON-RPC リクエストが正しくパースできること
  - [ ] 不正なリクエストがエラーとして処理されること
  - [ ] すべてのリクエストがログに記録されること
  - [ ] 単体テストが作成されていること

---

#### Day 28: レスポンスフォーマッターの実装
- **タスクタイプ**: TDD 🔵
- **要件名**: MCPエディタ統合サーバー
- **要件リンク**: [技術設計書 §3.1.2](../design/technical-design.md#312-レスポンスフォーマッター)
- **推定工数**: 8時間
- **タスク**: MCPレスポンスの整形とシリアライズを実装する
- **成果物**: `src/server/ResponseFormatter.ts`
  - 成功レスポンスの生成
  - エラーレスポンスの生成
  - JSON-RPC 形式への変換
  - タイムスタンプ付与
- **実装詳細**:
  - 設計書 §3.1.2 の ResponseFormatter クラスを実装
  - JSON-RPC 2.0 仕様に従ったレスポンス生成
  - 成功レスポンスに result フィールドを含める
  - エラーレスポンスに error コードとメッセージを含める
- **テスト要件**:
  - 成功レスポンスの生成テスト
  - エラーレスポンスの生成テスト
  - JSON-RPC形式の検証テスト
  - タイムスタンプ付与のテスト
- **依存関係**: Day 27
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] MCPプロトコルに準拠したレスポンスが生成できること
  - [ ] エラー情報が適切にフォーマットされること
  - [ ] 単体テストが作成されていること

---

#### Day 29: セキュリティバリデーターの統合
- **タスクタイプ**: TDD 🔵
- **要件名**: MCPエディタ統合サーバー
- **要件リンク**: [技術設計書 §6](../design/technical-design.md#6-セキュリティ機能)
- **推定工数**: 8時間
- **タスク**: リクエストハンドラーにセキュリティバリデーションを統合する
- **成果物**: `src/security/SecurityValidator.ts`
  - パス検証
  - コマンド検証
  - 操作ログ記録
  - 統合テスト
- **実装詳細**:
  - 設計書 §6 のセキュリティ機能を統合
  - PathValidator と CommandSanitizer を RequestHandler に統合
  - ファイル操作前にパス検証を実行
  - コマンド実行前にコマンド検証を実行
- **テスト要件**:
  - パス検証統合のテスト
  - コマンド検証統合のテスト
  - 検証失敗時のエラーレスポンステスト
  - 監査ログ記録のテスト
- **依存関係**: Day 28
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] すべてのファイル操作でパス検証が実行されること
  - [ ] すべてのコマンド実行で危険コマンド検証が実行されること
  - [ ] 検証失敗時に適切なエラーが返ること
  - [ ] 統合テストが作成されていること

---

#### Day 30: ツール定義の実装
- **タスクタイプ**: TDD 🔵
- **要件名**: MCPエディタ統合サーバー
- **要件リンク**: [技術設計書 §5](../design/technical-design.md#5-mcpツール定義)
- **推定工数**: 8時間
- **タスク**: MCPツールの定義とスキーマを実装する
- **成果物**: `src/server/tools/`
  - `tool-definitions.ts` (11種類のツール定義)
  - 各ツールのJSONスキーマ
  - `listTools()` メソッドの実装
- **実装詳細**:
  - 設計書 §5 の11種類のMCPツール定義を実装
  - 各ツールのJSON Schemaを作成
  - ツールメタデータ (name, description, parameters) を定義
  - listTools() メソッドで全ツールの一覧を返す
- **テスト要件**:
  - ツール定義の完全性テスト
  - JSONスキーマのバリデーションテスト
  - listTools() の返却値テスト
  - 各ツールのメタデータ検証テスト
- **依存関係**: Day 29
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] 11種類のツール定義が完成していること
  - [ ] 各ツールのJSONスキーマが設計書通りであること
  - [ ] `listTools()` で全ツールが返却されること
  - [ ] 単体テストが作成されていること

---

### Week 2: エディタアダプター基盤（5日間、40時間）

#### Day 31: エディタアダプター抽象クラスの実装
- **タスクタイプ**: TDD 🔵
- **要件名**: MCPエディタ統合サーバー
- **要件リンク**: [技術設計書 §3.2](../design/technical-design.md#32-エディタアダプター)
- **推定工数**: 8時間
- **タスク**: エディタアダプターの抽象化層を実装する
- **成果物**: `src/adapters/EditorAdapter.ts`
  - `IEditorAdapter` インターフェースの実装
  - 抽象メソッドの定義
  - エディタタイプの列挙
- **実装詳細**:
  - 設計書 §3.2 の IEditorAdapter インターフェースを実装
  - 4つのサブアダプター (ファイルシステム、テキストエディタ、ターミナル、診断情報) のインターフェース定義
  - EditorType 列挙型 (VSCode, Unity) を定義
  - 抽象メソッドのシグネチャを明確に定義
- **テスト要件**:
  - インターフェース定義の完全性テスト
  - 型の互換性テスト
  - 抽象メソッドの定義テスト
- **依存関係**: Day 30
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] エディタ非依存のインターフェースが定義されていること
  - [ ] 派生クラスで実装すべきメソッドが明確であること

---

#### Day 32: ファイルシステムアダプターの実装（VS Code用）
- **タスクタイプ**: TDD 🔵
- **要件名**: MCPエディタ統合サーバー
- **要件リンク**: [技術設計書 §3.2.1](../design/technical-design.md#321-ファイルシステムアダプター)
- **推定工数**: 8時間
- **タスク**: VS Code のファイルシステムAPIを抽象化する
- **成果物**: `src/adapters/VSCodeFileSystemAdapter.ts`
  - `IFileSystemAdapter` の実装
  - `workspace.fs` APIのラッピング
  - エラーハンドリング
- **実装詳細**:
  - 設計書 §3.2.1 の IFileSystemAdapter を実装
  - VS Code の workspace.fs API をラップ
  - readFile, writeFile, deleteFile, createDirectory, listFiles メソッドを実装
  - エラーを統一されたエラー型に変換
- **テスト要件**:
  - ファイル読み書きのテスト
  - ディレクトリ作成・削除のテスト
  - エラーハンドリングのテスト
  - VS Code APIとの連携テスト
- **依存関係**: Day 31
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] ファイル読み書きが正常に動作すること
  - [ ] ディレクトリ作成・削除が正常に動作すること
  - [ ] エラーが適切にハンドリングされること
  - [ ] 単体テストが作成されていること

---

#### Day 33: テキストエディタアダプターの実装（VS Code用）
- **タスクタイプ**: TDD 🔵
- **要件名**: MCPエディタ統合サーバー
- **要件リンク**: [技術設計書 §3.2.2](../design/technical-design.md#322-テキストエディタアダプター)
- **推定工数**: 8時間
- **タスク**: VS Code のテキストエディタAPIを抽象化する
- **成果物**: `src/adapters/VSCodeTextEditorAdapter.ts`
  - `ITextEditorAdapter` の実装
  - `TextDocument` の抽象化
  - `WorkspaceEdit` の抽象化
  - インデント設定の取得
- **実装詳細**:
  - 設計書 §3.2.2 の ITextEditorAdapter を実装
  - VS Code の TextDocument API をラップ
  - WorkspaceEdit を使用した編集処理
  - editor.tabSize と editor.insertSpaces 設定を取得
- **テスト要件**:
  - ドキュメント開閉のテスト
  - テキスト編集のテスト
  - インデント設定取得のテスト
  - WorkspaceEdit適用のテスト
- **依存関係**: Day 32
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] ドキュメントの開閉が正常に動作すること
  - [ ] テキスト編集が正常に動作すること
  - [ ] インデント設定が取得できること
  - [ ] 単体テストが作成されていること

---

#### Day 34: ターミナルアダプターの実装（VS Code用）
- **タスクタイプ**: TDD 🔵
- **要件名**: MCPエディタ統合サーバー
- **要件リンク**: [技術設計書 §3.2.3](../design/technical-design.md#323-ターミナルアダプター)
- **推定工数**: 8時間
- **タスク**: VS Code のターミナルAPIを抽象化する
- **成果物**: `src/adapters/VSCodeTerminalAdapter.ts`
  - `ITerminalAdapter` の実装
  - コマンド実行処理
  - stdout/stderr のキャプチャ
  - タイムアウト処理
- **実装詳細**:
  - 設計書 §3.2.3 の ITerminalAdapter を実装
  - child_process を使用したコマンド実行
  - stdout/stderr のストリーミングキャプチャ
  - Promise.race を使用したタイムアウト処理
- **テスト要件**:
  - コマンド実行のテスト
  - stdout/stderr キャプチャのテスト
  - タイムアウト処理のテスト
  - エラーハンドリングのテスト
- **依存関係**: Day 33
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] コマンドが正常に実行できること
  - [ ] stdout/stderr が正しくキャプチャできること
  - [ ] タイムアウトが正常に動作すること
  - [ ] 単体テストが作成されていること

---

#### Day 35: 診断情報アダプターの実装（VS Code用）
- **タスクタイプ**: TDD 🔵
- **要件名**: MCPエディタ統合サーバー
- **要件リンク**: [技術設計書 §3.2.4](../design/technical-design.md#324-診断情報アダプター)
- **推定工数**: 8時間
- **タスク**: VS Code の診断APIを抽象化する
- **成果物**: `src/adapters/VSCodeDiagnosticsAdapter.ts`
  - `IDiagnosticsAdapter` の実装
  - 診断情報の取得
  - コードアクション（QuickFix）の取得
- **実装詳細**:
  - 設計書 §3.2.4 の IDiagnosticsAdapter を実装
  - VS Code の languages.getDiagnostics API をラップ
  - CodeActionProvider を使用した QuickFix 取得
  - 診断情報を統一されたフォーマットに変換
- **テスト要件**:
  - ファイル診断情報取得のテスト
  - プロジェクト全体の診断情報取得のテスト
  - QuickFix取得のテスト
  - 診断情報フォーマット変換のテスト
- **依存関係**: Day 34
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] ファイルの診断情報が取得できること
  - [ ] プロジェクト全体の診断情報が取得できること
  - [ ] QuickFixが取得できること
  - [ ] 単体テストが作成されていること

---

### Week 3: VS Code アダプター統合（5日間、40時間）

#### Day 36: VS Code アダプター統合クラスの実装
- **タスクタイプ**: TDD 🔵
- **要件名**: MCPエディタ統合サーバー
- **要件リンク**: [技術設計書 §3.2](../design/technical-design.md#32-エディタアダプター)
- **推定工数**: 8時間
- **タスク**: すべてのVS Codeアダプターを統合する
- **成果物**: `src/adapters/VSCodeAdapter.ts`
  - `IEditorAdapter` の完全実装
  - サブアダプターの初期化
  - VS Code拡張APIへの接続
- **実装詳細**:
  - 設計書 §3.2 の VSCodeAdapter クラスを実装
  - 4つのサブアダプターをコンストラクタで初期化
  - VS Code拡張APIとの接続を確立
  - エラーハンドリングとロギングを統合
- **テスト要件**:
  - VSCodeAdapter初期化のテスト
  - サブアダプター利用可能性のテスト
  - VS Code API接続のテスト
  - 統合テスト
- **依存関係**: Day 35
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] VSCodeAdapterが正常に初期化できること
  - [ ] すべてのサブアダプターが利用可能であること
  - [ ] VS Code API接続が成功すること
  - [ ] 統合テストが作成されていること

---

#### Day 37: エディタアダプターファクトリーの実装
- **タスクタイプ**: TDD 🔵
- **要件名**: MCPエディタ統合サーバー
- **要件リンク**: [技術設計書 §3.2](../design/technical-design.md#32-エディタアダプター)
- **推定工数**: 8時間
- **タスク**: エディタタイプに応じたアダプターを生成するファクトリーを実装する
- **成果物**: `src/adapters/EditorAdapterFactory.ts`
  - エディタタイプの検出
  - 適切なアダプターの生成
  - Unity Editor 対応の準備（スタブ）
- **実装詳細**:
  - ファクトリーパターンでエディタアダプターを生成
  - 環境変数やAPIの存在でエディタタイプを検出
  - VSCodeAdapter を生成するロジックを実装
  - Unity Editor 用のスタブクラスを用意
- **テスト要件**:
  - エディタタイプ検出のテスト
  - VSCodeAdapter生成のテスト
  - 未サポートエディタのエラーテスト
  - ファクトリーメソッドのテスト
- **依存関係**: Day 36
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] VS Code アダプターが正しく生成されること
  - [ ] 未サポートエディタの場合にエラーが返ること
  - [ ] 単体テストが作成されていること

---

#### Day 38: 接続管理・再接続機能の実装
- **タスクタイプ**: TDD 🔵
- **要件名**: MCPエディタ統合サーバー
- **要件リンク**: [技術設計書 §3.4](../design/technical-design.md#34-接続管理)
- **推定工数**: 8時間
- **タスク**: エディタとの接続管理と自動再接続を実装する
- **成果物**: `src/server/ConnectionManager.ts`
  - 接続状態の監視
  - ハートビート機能
  - 自動再接続ロジック
  - 最大リトライ回数の制御
- **実装詳細**:
  - 設計書 §3.4 の ConnectionManager クラスを実装
  - 30秒間隔のハートビートで接続状態を監視
  - 接続断時に最大3回まで自動再接続を試行
  - 指数バックオフで再接続間隔を調整
- **テスト要件**:
  - 接続断検出のテスト
  - 自動再接続のテスト
  - ハートビート送信のテスト
  - リトライ回数制御のテスト
- **依存関係**: Day 37
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] 接続断が検出されること
  - [ ] 自動再接続が試行されること
  - [ ] ハートビートが定期的に送信されること
  - [ ] 単体テストが作成されていること

---

#### Day 39: 設定管理機能の実装
- **タスクタイプ**: TDD 🔵
- **要件名**: MCPエディタ統合サーバー
- **要件リンク**: [技術設計書 §3.6](../design/technical-design.md#36-設定管理)
- **推定工数**: 8時間
- **タスク**: エディタ設定の取得と管理機能を実装する
- **成果物**: `src/config/EditorConfigManager.ts`
  - エディタ設定の取得
  - ワークスペース設定の取得
  - インデント設定の管理
  - フォーマット設定の管理
- **実装詳細**:
  - VS Code の workspace.getConfiguration API を使用
  - editor.tabSize, editor.insertSpaces などの設定を取得
  - ファイルタイプごとの設定オーバーライドをサポート
  - 設定変更の監視機能を実装
- **テスト要件**:
  - エディタ設定取得のテスト
  - インデント設定取得のテスト
  - フォーマッター設定取得のテスト
  - 設定変更監視のテスト
- **依存関係**: Day 38
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] エディタの設定が取得できること
  - [ ] タブ/スペース設定が取得できること
  - [ ] フォーマッター設定が取得できること
  - [ ] 単体テストが作成されていること

---

#### Day 40: ワークスペース管理機能の実装
- **タスクタイプ**: TDD 🔵
- **要件名**: MCPエディタ統合サーバー
- **要件リンク**: [技術設計書 §3.7](../design/technical-design.md#37-ワークスペース管理)
- **推定工数**: 8時間
- **タスク**: マルチワークスペース対応の基盤を実装する
- **成果物**: `src/server/WorkspaceManager.ts`
  - 複数ワークスペースの検出
  - アクティブワークスペースの管理
  - ワークスペース切り替え機能
- **実装詳細**:
  - VS Code の workspace.workspaceFolders API を使用
  - アクティブなテキストエディタからワークスペースを判定
  - ワークスペースごとのプロジェクトルートを管理
  - ワークスペース変更イベントを監視
- **テスト要件**:
  - 複数ワークスペース検出のテスト
  - アクティブワークスペース特定のテスト
  - ワークスペース切り替えのテスト
  - プロジェクトルート取得のテスト
- **依存関係**: Day 39
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] 複数ワークスペースが検出できること
  - [ ] アクティブなワークスペースが特定できること
  - [ ] ワークスペースごとのプロジェクトルートが取得できること
  - [ ] 単体テストが作成されていること

---

### Week 4: マネージャー基盤実装（5日間、40時間）

#### Day 41: ファイル操作マネージャーの骨格実装
- **タスクタイプ**: TDD 🔵
- **要件名**: MCPエディタ統合サーバー
- **要件リンク**: [技術設計書 §3.3.1](../design/technical-design.md#331-ファイル操作マネージャー)
- **推定工数**: 8時間
- **タスク**: `IFileOperationManager` の基本実装を行う
- **成果物**: `src/managers/FileOperationManager.ts`
  - クラス構造の定義
  - エディタアダプターとの連携
  - セキュリティバリデーターとの統合
- **実装詳細**:
  - 設計書 §3.3.1 の FileOperationManager クラスを実装
  - コンストラクタでエディタアダプターを依存注入
  - PathValidator を使用したパス検証処理を統合
  - メソッドのシグネチャを定義（実装は Phase 3）
- **テスト要件**:
  - クラスのインスタンス化テスト
  - 依存注入のテスト
  - パス検証統合のテスト
  - インターフェース準拠のテスト
- **依存関係**: Day 40
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] FileOperationManagerクラスが定義されていること
  - [ ] エディタアダプターを依存注入できること
  - [ ] パス検証が統合されていること

---

#### Day 42: コードエディタマネージャーの骨格実装
- **タスクタイプ**: TDD 🔵
- **要件名**: MCPエディタ統合サーバー
- **要件リンク**: [技術設計書 §3.3.2](../design/technical-design.md#332-コードエディタマネージャー)
- **推定工数**: 8時間
- **タスク**: `ICodeEditorManager` の基本実装を行う
- **成果物**: `src/managers/CodeEditorManager.ts`
  - クラス構造の定義
  - テキストエディタアダプターとの連携
  - インデント処理の準備
- **実装詳細**:
  - 設計書 §3.3.2 の CodeEditorManager クラスを実装
  - コンストラクタでテキストエディタアダプターを依存注入
  - EditorConfigManager を使用してインデント設定を取得
  - メソッドのシグネチャを定義（実装は Phase 4）
- **テスト要件**:
  - クラスのインスタンス化テスト
  - 依存注入のテスト
  - インデント設定取得のテスト
  - インターフェース準拠のテスト
- **依存関係**: Day 41
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] CodeEditorManagerクラスが定義されていること
  - [ ] エディタアダプターを依存注入できること
  - [ ] インデント設定を取得できること

---

#### Day 43: ターミナル実行マネージャーの骨格実装
- **タスクタイプ**: TDD 🔵
- **要件名**: MCPエディタ統合サーバー
- **要件リンク**: [技術設計書 §3.3.3](../design/technical-design.md#333-ターミナル実行マネージャー)
- **推定工数**: 8時間
- **タスク**: `ITerminalExecutor` の基本実装を行う
- **成果物**: `src/managers/TerminalExecutor.ts`
  - クラス構造の定義
  - ターミナルアダプターとの連携
  - コマンドサニタイゼーションの統合
- **実装詳細**:
  - 設計書 §3.3.3 の TerminalExecutor クラスを実装
  - コンストラクタでターミナルアダプターを依存注入
  - CommandSanitizer を使用したコマンド検証処理を統合
  - メソッドのシグネチャを定義（実装は Phase 5）
- **テスト要件**:
  - クラスのインスタンス化テスト
  - 依存注入のテスト
  - コマンド検証統合のテスト
  - インターフェース準拠のテスト
- **依存関係**: Day 42
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] TerminalExecutorクラスが定義されていること
  - [ ] エディタアダプターを依存注入できること
  - [ ] コマンド検証が統合されていること

---

#### Day 44: 診断情報プロバイダーの骨格実装
- **タスクタイプ**: TDD 🔵
- **要件名**: MCPエディタ統合サーバー
- **要件リンク**: [技術設計書 §3.3.4](../design/technical-design.md#334-診断情報プロバイダー)
- **推定工数**: 8時間
- **タスク**: `IDiagnosticsProvider` の基本実装を行う
- **成果物**: `src/managers/DiagnosticsProvider.ts`
  - クラス構造の定義
  - 診断アダプターとの連携
  - QuickFix管理の準備
- **実装詳細**:
  - 設計書 §3.3.4 の DiagnosticsProvider クラスを実装
  - コンストラクタで診断アダプターを依存注入
  - 診断情報とQuickFixのキャッシュ機構を準備
  - メソッドのシグネチャを定義（実装は Phase 6）
- **テスト要件**:
  - クラスのインスタンス化テスト
  - 依存注入のテスト
  - 診断情報取得の準備テスト
  - インターフェース準拠のテスト
- **依存関係**: Day 43
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] DiagnosticsProviderクラスが定義されていること
  - [ ] エディタアダプターを依存注入できること
  - [ ] 診断情報を取得できる構造になっていること

---

#### Day 45: 依存性注入コンテナの実装
- **タスクタイプ**: TDD 🔵
- **要件名**: MCPエディタ統合サーバー
- **要件リンク**: [技術設計書 §3.5](../design/technical-design.md#35-依存性注入)
- **推定工数**: 8時間
- **タスク**: すべてのコンポーネントを統合するDIコンテナを実装する
- **成果物**: `src/di/Container.ts`
  - サービスの登録
  - 依存関係の解決
  - シングルトン管理
  - ファクトリーメソッド
- **実装詳細**:
  - 設計書 §3.5 の DIContainer クラスを実装
  - register() メソッドでサービスを登録
  - resolve() メソッドで依存関係を自動解決
  - シングルトンインスタンスをMapで管理
  - ファクトリーメソッドでインスタンス生成をカスタマイズ
- **テスト要件**:
  - サービス登録のテスト
  - 依存関係自動解決のテスト
  - シングルトン管理のテスト
  - ファクトリーメソッドのテスト
- **依存関係**: Day 44
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] すべてのマネージャーが登録できること
  - [ ] 依存関係が自動解決されること
  - [ ] シングルトンが正しく機能すること
  - [ ] 単体テストが作成されていること

---

### Week 5: 統合とテスト（5日間、40時間）

#### Day 46: サーバー起動・初期化フローの実装
- **タスクタイプ**: TDD 🔵
- **要件名**: MCPエディタ統合サーバー
- **要件リンク**: [技術設計書 §11](../design/technical-design.md#11-デプロイメント)
- **推定工数**: 8時間
- **タスク**: サーバーの起動から初期化までの完全なフローを実装する
- **成果物**: `src/index.ts`
  - メインエントリポイント
  - 環境変数の読み込み
  - DIコンテナの初期化
  - MCPサーバーの起動
- **実装詳細**:
  - 設計書 §11 のデプロイメント手順に従った起動フローを実装
  - dotenv で環境変数を読み込み
  - DIContainer を初期化し、全サービスを登録
  - MCPServer を起動し、stdio で通信開始
  - グレースフルシャットダウンを実装
- **テスト要件**:
  - サーバー起動のテスト
  - 環境変数読み込みのテスト
  - DIコンテナ初期化のテスト
  - グレースフルシャットダウンのテスト
- **依存関係**: Day 45
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] サーバーが正常に起動すること
  - [ ] 環境変数が正しく読み込まれること
  - [ ] すべてのコンポーネントが初期化されること
  - [ ] エラー時に適切なログが出力されること

---

#### Day 47: E2Eテストの基盤構築
- **タスクタイプ**: DIRECT 🔵
- **要件名**: MCPエディタ統合サーバー
- **要件リンク**: [技術設計書 §10](../design/technical-design.md#10-テスト戦略)
- **推定工数**: 8時間
- **タスク**: VS Codeとの統合E2Eテスト環境を構築する
- **成果物**: `tests/e2e/`
  - VS Code拡張テストランナーの設定
  - テストワークスペースの準備
  - E2Eテストヘルパー関数
- **実装詳細**:
  - 設計書 §10.3 のE2Eテスト戦略に従った環境構築
  - @vscode/test-electron を使用したテストランナー設定
  - テスト用のワークスペースフォルダを作成
  - E2Eテストヘルパー関数を実装（サーバー起動、クライアント接続など）
- **依存関係**: Day 46
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] E2Eテストが実行できる環境が整っていること
  - [ ] テストワークスペースが用意されていること
  - [ ] VS Code拡張としてテストが実行できること

---

#### Day 48: 統合テストの作成
- **タスクタイプ**: TDD 🔵
- **要件名**: MCPエディタ統合サーバー
- **要件リンク**: [技術設計書 §10.2](../design/technical-design.md#102-統合テスト)
- **推定工数**: 8時間
- **タスク**: Phase 2 全体の統合テストを作成する
- **成果物**: `tests/integration/phase2.test.ts`
  - MCPサーバー起動テスト
  - ツールリスト取得テスト
  - リクエスト/レスポンステスト
  - エラーハンドリングテスト
- **実装詳細**:
  - 設計書 §10.2 の統合テスト戦略に従ったテスト実装
  - MCPサーバー起動・停止のテスト
  - listTools リクエストのテスト
  - 各種リクエスト/レスポンスのテスト
  - エラーケースのテスト
- **テスト要件**:
  - サーバー起動・停止のテスト
  - ツールリスト取得のテスト
  - リクエスト処理のテスト
  - エラーハンドリングのテスト
- **依存関係**: Day 47
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] サーバーが正常に起動・停止すること
  - [ ] ツールリストが取得できること
  - [ ] リクエストが正しく処理されること
  - [ ] エラーが適切にハンドリングされること

---

#### Day 49: パフォーマンステストの実施
- **タスクタイプ**: TDD 🔵
- **要件名**: MCPエディタ統合サーバー
- **要件リンク**: [技術設計書 §8](../design/technical-design.md#8-パフォーマンス)
- **推定工数**: 8時間
- **タスク**: レスポンスタイムとスループットのテストを実施する
- **成果物**: `tests/performance/phase2-perf.test.ts`
  - 起動時間の測定
  - リクエスト処理時間の測定
  - 同時実行テスト
  - メモリ使用量の測定
- **実装詳細**:
  - 設計書 §8 のパフォーマンス要件を検証するテスト実装
  - performance.now() で起動時間を測定
  - リクエスト処理時間を測定（目標: 100ms以内）
  - 10並列リクエストの同時実行テスト
  - process.memoryUsage() でメモリ使用量を監視
- **テスト要件**:
  - 起動時間測定のテスト
  - リクエスト処理時間測定のテスト
  - 同時実行のテスト
  - メモリリーク検出のテスト
- **依存関係**: Day 48
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] 起動時間が5秒以内であること
  - [ ] リクエスト処理が設計書の目標値以内であること
  - [ ] 10並列リクエストが正常に処理できること
  - [ ] メモリリークがないこと

---

#### Day 50: Phase 2 総合テストとドキュメント整備
- **タスクタイプ**: DIRECT 🔵
- **要件名**: MCPエディタ統合サーバー
- **要件リンク**: [技術設計書 §12](../design/technical-design.md#12-ドキュメント)
- **推定工数**: 8時間
- **タスク**: Phase 2の完了確認とドキュメント更新
- **成果物**:
  - Phase 2完了レポート
  - APIドキュメント
  - 実装ガイド
  - トラブルシューティングガイド
- **実装詳細**:
  - 設計書 §12 のドキュメント要件に従ったドキュメント作成
  - Phase 2の全テストを実行し、完了レポートを作成
  - TypeDoc でAPIドキュメントを生成
  - 実装ガイドとトラブルシューティングガイドをMarkdownで作成
  - テストカバレッジレポートを生成
- **依存関係**: Day 49
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] すべてのテストがパスすること
  - [ ] テストカバレッジが80%以上であること
  - [ ] APIドキュメントが整備されていること
  - [ ] ビルドエラーがないこと
  - [ ] Lintエラーがないこと

---

## Phase 2 完了基準

- [ ] MCPサーバーのコア機能が実装されている
- [ ] リクエストハンドラーとレスポンスフォーマッターが実装されている
- [ ] VS Code アダプター（4種類）が実装されている
- [ ] セキュリティバリデーションが統合されている
- [ ] 接続管理・再接続機能が実装されている
- [ ] DIコンテナが実装されている
- [ ] すべてのマネージャーの骨格が実装されている
- [ ] 単体テストカバレッジが80%以上
- [ ] 統合テストがパスする
- [ ] E2Eテスト環境が整っている
- [ ] パフォーマンス要件を満たしている

---

## Phase 2 成果物サマリー

| カテゴリ | 成果物 | 推定工数 | 完了 |
|---------|--------|---------|------|
| MCPサーバー | MCPServer, RequestHandler, ResponseFormatter | 24時間 | ☐ |
| セキュリティ | SecurityValidator統合 | 8時間 | ☐ |
| アダプター | VSCodeAdapter (4種類) | 40時間 | ☐ |
| マネージャー骨格 | FileOperationManager, CodeEditorManager, TerminalExecutor, DiagnosticsProvider | 32時間 | ☐ |
| インフラ | ConnectionManager, WorkspaceManager, DIContainer | 24時間 | ☐ |
| テスト | 単体テスト、統合テスト、E2Eテスト基盤 | 56時間 | ☐ |
| ドキュメント | APIドキュメント、実装ガイド | 16時間 | ☐ |
| **合計** | **25タスク** | **200時間** | **0/25** |

---

**前のフェーズ**: [Phase 1: プロジェクトセットアップ](./phase-1-project-setup.md)
**次のフェーズ**: [Phase 3: ファイル操作機能実装](./phase-3-file-operations.md)
