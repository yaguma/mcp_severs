# Phase 6: 診断・修正機能実装（約1ヶ月）

**期間**: 2026年4月 - 2026年5月
**目標**: エラー検出、診断情報取得、クイックフィックス機能の完全実装

---

## タスク一覧

### Week 1: 診断情報取得機能の実装（5日間）

#### Day 126: get_diagnostics ツールの実装（基本）
- **タスク**: ファイルの診断情報を取得する基本機能を実装する
- **成果物**: `src/managers/DiagnosticsProvider.ts` の `getDiagnostics()` メソッド
  - 診断アダプターとの連携
  - 診断情報の取得
  - 診断結果の整形
  - 重要度の分類
- **依存関係**: Phase 5 完了
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] ファイルの診断情報が取得できること
  - [ ] エラー・警告・情報が区別されること
  - [ ] ファイルパスと行番号が含まれること
  - [ ] 単体テストが作成されていること

---

#### Day 127: プロジェクト全体の診断情報取得
- **タスク**: プロジェクト全体の診断情報を取得する機能を実装する
- **成果物**: `getAllDiagnostics()` メソッドの実装
  - 全ファイルの走査
  - 診断情報の集約
  - ファイルごとのグループ化
  - 効率的な取得処理
- **依存関係**: Day 126
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] プロジェクト全体の診断情報が取得できること
  - [ ] ファイルごとにグループ化されること
  - [ ] パフォーマンスが許容範囲内であること
  - [ ] 統合テストが作成されていること

---

#### Day 128: 診断情報のフィルタリング機能
- **タスク**: 診断情報を重要度やソースでフィルタする機能を実装する
- **成果物**: `getDiagnostics()` メソッドの拡張
  - 重要度フィルター（error/warning/info）
  - ソースフィルター（typescript/eslint等）
  - パターンフィルター
- **依存関係**: Day 127
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] 重要度でフィルタできること
  - [ ] ソースでフィルタできること
  - [ ] 複数条件の組み合わせができること
  - [ ] 単体テストが作成されていること

---

#### Day 129: 診断情報のキャッシング
- **タスク**: 診断情報をキャッシュして高速化する機能を実装する
- **成果物**: `src/utils/DiagnosticsCache.ts`
  - 診断結果のキャッシュ
  - ファイル更新時の無効化
  - キャッシュの有効期限管理
- **依存関係**: Day 128
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] 診断情報がキャッシュされること
  - [ ] ファイル更新時にキャッシュが無効化されること
  - [ ] キャッシュヒット時のレスポンスが高速であること
  - [ ] 単体テストが作成されていること

---

#### Day 130: get_diagnostics ツール定義の完成
- **タスク**: MCPツールとして get_diagnostics を登録・公開する
- **成果物**:
  - `src/server/tools/GetDiagnosticsTool.ts`
  - ツール定義の登録
  - E2Eテスト
- **依存関係**: Day 129
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] get_diagnostics ツールが listTools() に含まれること
  - [ ] MCPクライアントから呼び出せること
  - [ ] E2Eテストが作成されていること

---

### Week 2: クイックフィックス機能の実装（5日間）

#### Day 131: get_quick_fixes ツールの実装
- **タスク**: 診断に対するクイックフィックスを取得する機能を実装する
- **成果物**: `src/managers/DiagnosticsProvider.ts` の `getQuickFixes()` メソッド
  - 診断情報からのクイックフィックス取得
  - 複数の修正候補の提示
  - 修正内容の説明
- **依存関係**: Day 130
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] クイックフィックス候補が取得できること
  - [ ] 各修正候補に説明が含まれること
  - [ ] 単体テストが作成されていること

---

#### Day 132: クイックフィックスのプレビュー機能
- **タスク**: クイックフィックス適用前のdiffプレビューを実装する
- **成果物**: `getQuickFixes()` メソッドの拡張
  - 修正前後のdiff生成
  - 影響範囲の表示
  - 複数ファイルへの影響の検出
- **依存関係**: Day 131
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] diffプレビューが生成されること
  - [ ] 影響範囲が明確であること
  - [ ] 統合テストが作成されていること

---

#### Day 133: apply_quick_fix ツールの実装
- **タスク**: クイックフィックスを適用する機能を実装する
- **成果物**: `src/managers/DiagnosticsProvider.ts` の `applyQuickFix()` メソッド
  - クイックフィックスIDの解決
  - テキスト編集の適用
  - 複数ファイルへの変更
  - 変更内容の返却
- **依存関係**: Day 132
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] クイックフィックスが正しく適用されること
  - [ ] 複数ファイルの変更ができること
  - [ ] 変更されたファイル一覧が返ること
  - [ ] 単体テストが作成されていること

---

#### Day 134: クイックフィックスのロールバック機能
- **タスク**: 適用したクイックフィックスを元に戻す機能を実装する
- **成果物**: `applyQuickFix()` メソッドの拡張
  - 適用前の状態の保存
  - ロールバック処理
  - undoスタックの管理
- **依存関係**: Day 133
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] クイックフィックスをロールバックできること
  - [ ] 複数回のundo/redoができること
  - [ ] 統合テストが作成されていること

---

#### Day 135: get_quick_fixes, apply_quick_fix ツール定義の完成
- **タスク**: MCPツールとして2つのツールを登録・公開する
- **成果物**:
  - `src/server/tools/GetQuickFixesTool.ts`
  - `src/server/tools/ApplyQuickFixTool.ts`
  - E2Eテスト
- **依存関係**: Day 134
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] 2つのツールが listTools() に含まれること
  - [ ] MCPクライアントから呼び出せること
  - [ ] E2Eテストが作成されていること

---

### Week 3: 診断ソース統合（5日間）

#### Day 136: TypeScript 診断の統合
- **タスク**: TypeScript コンパイラの診断情報を統合する
- **成果物**: DiagnosticsProvider の拡張
  - TypeScript Language Service との連携
  - 型エラーの取得
  - TypeScript クイックフィックスの取得
- **依存関係**: Day 135
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] TypeScript エラーが取得できること
  - [ ] TypeScript クイックフィックスが利用できること
  - [ ] 統合テストが作成されていること

---

#### Day 137: ESLint 診断の統合
- **タスク**: ESLint の診断情報を統合する
- **成果物**: DiagnosticsProvider の拡張
  - ESLint との連携
  - Lint エラー・警告の取得
  - ESLint autofix の利用
- **依存関係**: Day 136
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] ESLint エラーが取得できること
  - [ ] autofix が利用できること
  - [ ] 統合テストが作成されていること

---

#### Day 138: Prettier 統合
- **タスク**: Prettier のフォーマット診断を統合する
- **成果物**: DiagnosticsProvider の拡張
  - Prettier との連携
  - フォーマット不整合の検出
  - 自動フォーマット提案
- **依存関係**: Day 137
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] フォーマット不整合が検出されること
  - [ ] 自動フォーマットが提案されること
  - [ ] 単体テストが作成されていること

---

#### Day 139: その他の診断ソース統合
- **タスク**: その他の診断ソース（Stylelint, HTMLHint等）を統合する
- **成果物**: DiagnosticsProvider の拡張
  - プラグイン可能なアーキテクチャ
  - 診断ソースの動的登録
  - 優先度管理
- **依存関係**: Day 138
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] 複数の診断ソースが統合されていること
  - [ ] 診断ソースを動的に追加できること
  - [ ] 統合テストが作成されていること

---

#### Day 140: 診断ソース統合の包括的テスト
- **タスク**: すべての診断ソースをテストする
- **成果物**: `tests/integration/diagnostics-sources.test.ts`
  - 各診断ソースのテスト
  - 診断の優先度テスト
  - 競合の解決テスト
- **依存関係**: Day 139
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] すべてのテストがパスすること
  - [ ] テストカバレッジが90%以上であること

---

### Week 4: インテリジェント診断機能（5日間）

#### Day 141: 診断の優先度付け
- **タスク**: 診断情報に優先度を付けて表示する機能を実装する
- **成果物**: `src/utils/DiagnosticsPrioritizer.ts`
  - エラーの深刻度評価
  - 頻度分析
  - 影響範囲の評価
  - 優先度スコアリング
- **依存関係**: Day 140
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] 診断に優先度が付与されること
  - [ ] 重要なエラーが上位に表示されること
  - [ ] 単体テストが作成されていること

---

#### Day 142: 診断の関連性分析
- **タスク**: 関連する診断をグループ化する機能を実装する
- **成果物**: DiagnosticsPrioritizer の拡張
  - 同一原因のエラーのグループ化
  - 依存関係の検出
  - ルート原因の特定
- **依存関係**: Day 141
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] 関連する診断がグループ化されること
  - [ ] ルート原因が特定されること
  - [ ] 統合テストが作成されていること

---

#### Day 143: AI駆動の修正提案
- **タスク**: AIによる修正提案を生成する機能を実装する（オプション）
- **成果物**: `src/utils/AIFixSuggester.ts`
  - エラーパターンの学習
  - 修正候補の生成
  - 信頼度スコアリング
- **依存関係**: Day 142
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] 修正候補が生成されること
  - [ ] 信頼度スコアが付与されること
  - [ ] 単体テストが作成されていること

---

#### Day 144: 診断レポート生成
- **タスク**: 診断情報をレポート形式で出力する機能を実装する
- **成果物**: `src/utils/DiagnosticsReporter.ts`
  - マークダウン形式のレポート
  - HTML形式のレポート
  - 統計情報の集計
- **依存関係**: Day 143
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] レポートが生成されること
  - [ ] 統計情報が含まれること
  - [ ] 単体テストが作成されていること

---

#### Day 145: Phase 6 総合テストとベンチマーク
- **タスク**: Phase 6の完了確認とパフォーマンスベンチマーク
- **成果物**:
  - `tests/performance/diagnostics-perf.test.ts`
  - Phase 6完了レポート
  - パフォーマンスベンチマーク結果
- **依存関係**: Day 144
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] すべての診断機能が動作すること
  - [ ] 診断取得が1秒以内であること
  - [ ] テストカバレッジが90%以上であること

---

### Week 5: ドキュメント整備とリファクタリング（5日間）

#### Day 146: 診断・修正APIドキュメントの作成
- **タスク**: 診断とクイックフィックスのAPIドキュメントを作成する
- **成果物**: `docs/api/diagnostics.md`
  - get_diagnostics API仕様
  - get_quick_fixes API仕様
  - apply_quick_fix API仕様
  - 診断ソース一覧
  - サンプルコード
- **依存関係**: Day 145
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] すべてのAPIが文書化されていること
  - [ ] サンプルコードが動作すること

---

#### Day 147: ユーザーガイドの作成
- **タスク**: 診断とクイックフィックスのユーザーガイドを作成する
- **成果物**: `docs/user-guide/diagnostics.md`
  - 診断情報の見方
  - クイックフィックスの使い方
  - 診断ソースの設定方法
  - トラブルシューティング
- **依存関係**: Day 146
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] 初心者でも理解できる内容であること
  - [ ] 実用的な例が含まれていること

---

#### Day 148: エラーハンドリングの改善
- **タスク**: 診断機能のエラーハンドリングを見直す
- **成果物**:
  - より詳細なエラーメッセージ
  - 診断ソースエラーの分離
  - フォールバック機構
- **依存関係**: Day 147
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] エラーメッセージが明確であること
  - [ ] 一部の診断ソースが失敗しても継続できること

---

#### Day 149: コードレビューとリファクタリング
- **タスク**: Phase 6のコード全体をレビューしリファクタリングする
- **成果物**:
  - コードレビューレポート
  - リファクタリング実施
  - コード品質の向上
- **依存関係**: Day 148
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] Lintエラーがないこと
  - [ ] コードの可読性が向上していること

---

#### Day 150: Phase 6 最終レビューと完了確認
- **タスク**: Phase 6の完全性を確認し、次フェーズへの準備を行う
- **成果物**:
  - Phase 6最終レポート
  - Phase 7への引き継ぎ事項
- **依存関係**: Day 149
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] すべての機能が完成していること
  - [ ] すべてのテストがパスすること
  - [ ] ドキュメントが整備されていること

---

## Phase 6 完了基準

- [ ] get_diagnostics ツールが完全に実装されている
- [ ] get_quick_fixes ツールが完全に実装されている
- [ ] apply_quick_fix ツールが完全に実装されている
- [ ] TypeScript 診断が統合されている
- [ ] ESLint 診断が統合されている
- [ ] Prettier 診断が統合されている
- [ ] 診断のフィルタリングが動作している
- [ ] クイックフィックスのプレビューが動作している
- [ ] 診断のキャッシングが動作している
- [ ] 診断の優先度付けが動作している
- [ ] 単体テストカバレッジが90%以上
- [ ] 統合テストがすべてパスする
- [ ] APIドキュメントとユーザーガイドが完成している

---

## Phase 6 成果物サマリー

| カテゴリ | 成果物 | 完了 |
|---------|--------|------|
| 診断 | get_diagnostics, getAllDiagnostics | ☐ |
| クイックフィックス | get_quick_fixes, apply_quick_fix | ☐ |
| 診断ソース | TypeScript, ESLint, Prettier統合 | ☐ |
| 高度な機能 | 優先度付け、関連性分析、レポート生成 | ☐ |
| 最適化 | キャッシング、フィルタリング | ☐ |
| テスト | 単体テスト、統合テスト、パフォーマンステスト | ☐ |
| ドキュメント | APIドキュメント、ユーザーガイド | ☐ |

---

**前のフェーズ**: [Phase 5: ターミナル・ビルド機能実装](./phase-5-terminal-build.md)
**次のフェーズ**: [Phase 7: テスト・品質保証](./phase-7-testing.md)
