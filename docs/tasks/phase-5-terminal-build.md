# Phase 5: ターミナル・ビルド機能実装（約1ヶ月）

**期間**: 2026年3月 - 2026年4月
**目標**: ターミナルコマンド実行とビルドツール統合の完全実装

---

## タスク一覧

### Week 1: ターミナルコマンド実行の実装（5日間）

#### Day 101: execute_command ツールの実装（基本）
- **タスク**: コマンド実行の基本機能を実装する
- **成果物**: `src/managers/TerminalExecutor.ts` の `executeCommand()` メソッド
  - コマンドの実行
  - stdout/stderr のキャプチャ
  - 終了コードの取得
  - 基本的なエラーハンドリング
- **依存関係**: Phase 4 完了
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] コマンドが正常に実行できること
  - [ ] stdout が正しくキャプチャされること
  - [ ] stderr が正しくキャプチャされること
  - [ ] 終了コードが正確であること
  - [ ] 単体テストが作成されていること

---

#### Day 102: コマンドサニタイゼーションの統合
- **タスク**: 危険なコマンドの検出とブロック機能を統合する
- **成果物**: `executeCommand()` メソッドの拡張
  - CommandSanitizer との連携
  - 危険なコマンドパターンのチェック
  - ブロック時のエラー返却
  - 監査ログへの記録
- **依存関係**: Day 101
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] 危険なコマンドがブロックされること
  - [ ] ブロックされたコマンドがログに記録されること
  - [ ] 安全なコマンドは実行されること
  - [ ] 統合テストが作成されていること

---

#### Day 103: タイムアウト処理の実装
- **タスク**: 長時間実行コマンドのタイムアウト機能を実装する
- **成果物**: `executeCommand()` メソッドの拡張
  - timeout パラメータの処理
  - タイムアウト監視
  - プロセスの強制終了
  - タイムアウトエラーの返却
- **依存関係**: Day 102
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] 指定時間でタイムアウトすること
  - [ ] タイムアウト時にプロセスが終了すること
  - [ ] タイムアウトエラーが返ること
  - [ ] 単体テストが作成されていること

---

#### Day 104: バックグラウンド実行機能の実装
- **タスク**: バックグラウンドでのコマンド実行機能を実装する
- **成果物**: `executeCommand()` メソッドの拡張
  - background フラグの処理
  - プロセスIDの管理
  - 非同期実行
  - 進捗状況の取得
- **依存関係**: Day 103
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] バックグラウンドで実行できること
  - [ ] プロセスIDが返ること
  - [ ] 進捗状況が取得できること
  - [ ] 統合テストが作成されていること

---

#### Day 105: execute_command ツール定義の完成
- **タスク**: MCPツールとして execute_command を登録・公開する
- **成果物**:
  - `src/server/tools/ExecuteCommandTool.ts`
  - ツール定義の登録
  - E2Eテスト
- **依存関係**: Day 104
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] execute_command ツールが listTools() に含まれること
  - [ ] MCPクライアントから呼び出せること
  - [ ] E2Eテストが作成されていること

---

### Week 2: ビルドツール検出と実行（5日間）

#### Day 106: ビルドツール検出の改善
- **タスク**: Phase 1で実装したビルドツール検出を拡張する
- **成果物**: `src/managers/BuildToolDetector.ts` の拡張
  - より正確な検出ロジック
  - 複数ビルドツールへの対応
  - ビルドスクリプトの解析
- **依存関係**: Day 105
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] npm/yarn/pnpm を正確に検出できること
  - [ ] Maven/Gradle を検出できること
  - [ ] MSBuild/.NET を検出できること
  - [ ] 単体テストが作成されていること

---

#### Day 107: npm/yarn/pnpm ビルドの実装
- **タスク**: Node.js プロジェクトのビルド機能を実装する
- **成果物**: `src/managers/TerminalExecutor.ts` の `executeBuild()` メソッド
  - package.json の読み取り
  - build スクリプトの実行
  - ビルドログの解析
  - エラー・警告の抽出
- **依存関係**: Day 106
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] npm build が実行できること
  - [ ] yarn build が実行できること
  - [ ] pnpm build が実行できること
  - [ ] ビルドエラーが正しく解析されること
  - [ ] 統合テストが作成されていること

---

#### Day 108: Maven/Gradle ビルドの実装
- **タスク**: Java プロジェクトのビルド機能を実装する
- **成果物**: `executeBuild()` メソッドの拡張
  - Maven ビルドの実行
  - Gradle ビルドの実行
  - ビルドログの解析
  - エラー・警告の抽出
- **依存関係**: Day 107
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] mvn compile が実行できること
  - [ ] gradle build が実行できること
  - [ ] ビルドエラーが正しく解析されること
  - [ ] 単体テストが作成されていること

---

#### Day 109: MSBuild/.NET ビルドの実装
- **タスク**: .NET プロジェクトのビルド機能を実装する
- **成果物**: `executeBuild()` メソッドの拡張
  - MSBuild の実行
  - dotnet build の実行
  - ビルドログの解析
  - エラー・警告の抽出
- **依存関係**: Day 108
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] msbuild が実行できること
  - [ ] dotnet build が実行できること
  - [ ] ビルドエラーが正しく解析されること
  - [ ] 単体テストが作成されていること

---

#### Day 110: execute_build ツール定義の完成
- **タスク**: MCPツールとして execute_build を登録・公開する
- **成果物**:
  - `src/server/tools/ExecuteBuildTool.ts`
  - ツール定義の登録
  - E2Eテスト
- **依存関係**: Day 109
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] execute_build ツールが listTools() に含まれること
  - [ ] MCPクライアントから呼び出せること
  - [ ] E2Eテストが作成されていること

---

### Week 3: ビルドログ解析とエラー処理（5日間）

#### Day 111: ビルドログパーサーの実装
- **タスク**: ビルドログを構造化データに変換するパーサーを実装する
- **成果物**: `src/utils/BuildLogParser.ts`
  - ログ行の解析
  - エラー・警告の抽出
  - ファイル名・行番号の特定
  - 重要度の判定
- **依存関係**: Day 110
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] ビルドエラーが正しく抽出されること
  - [ ] 警告が正しく抽出されること
  - [ ] ファイル・行番号が特定されること
  - [ ] 単体テストが作成されていること

---

#### Day 112: TypeScript/ESLint エラー解析
- **タスク**: TypeScript と ESLint のエラーメッセージを解析する
- **成果物**: BuildLogParser の拡張
  - TypeScript エラーフォーマットの解析
  - ESLint エラーフォーマットの解析
  - エラーコードの抽出
- **依存関係**: Day 111
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] TypeScript エラーが正しく解析されること
  - [ ] ESLint エラーが正しく解析されること
  - [ ] エラーコードが含まれること
  - [ ] 単体テストが作成されていること

---

#### Day 113: Maven/Gradle エラー解析
- **タスク**: Maven と Gradle のエラーメッセージを解析する
- **成果物**: BuildLogParser の拡張
  - Maven エラーフォーマットの解析
  - Gradle エラーフォーマットの解析
  - スタックトレースの処理
- **依存関係**: Day 112
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] Maven エラーが正しく解析されること
  - [ ] Gradle エラーが正しく解析されること
  - [ ] スタックトレースが含まれること
  - [ ] 単体テストが作成されていること

---

#### Day 114: MSBuild/.NET エラー解析
- **タスク**: MSBuild と .NET のエラーメッセージを解析する
- **成果物**: BuildLogParser の拡張
  - MSBuild エラーフォーマットの解析
  - C# コンパイラエラーの解析
  - エラーコードの抽出
- **依存関係**: Day 113
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] MSBuild エラーが正しく解析されること
  - [ ] C# エラーが正しく解析されること
  - [ ] エラーコードが含まれること
  - [ ] 単体テストが作成されていること

---

#### Day 115: ビルドログの包括的テスト
- **タスク**: すべてのビルドツールのログ解析をテストする
- **成果物**: `tests/integration/build-log-parser.test.ts`
  - 各ビルドツールのテスト
  - エラー・警告の検出テスト
  - エッジケーステスト
- **依存関係**: Day 114
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] すべてのテストがパスすること
  - [ ] テストカバレッジが90%以上であること

---

### Week 4: プロセス管理と高度な機能（5日間）

#### Day 116: プロセス管理機能の実装
- **タスク**: 実行中のプロセスを管理する機能を実装する
- **成果物**: `src/managers/ProcessManager.ts`
  - プロセスの登録・管理
  - プロセス一覧の取得
  - プロセスの終了
  - プロセス状態の監視
- **依存関係**: Day 115
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] プロセスが登録されること
  - [ ] プロセス一覧が取得できること
  - [ ] プロセスを終了できること
  - [ ] 単体テストが作成されていること

---

#### Day 117: プロセス出力のストリーミング
- **タスク**: 長時間実行プロセスの出力をリアルタイムで取得する機能を実装する
- **成果物**: ProcessManager の拡張
  - ストリーミング出力の取得
  - 出力バッファリング
  - 部分出力の返却
- **依存関係**: Day 116
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] リアルタイムで出力が取得できること
  - [ ] バッファオーバーフローが防げること
  - [ ] 統合テストが作成されていること

---

#### Day 118: 環境変数とワークディレクトリの管理
- **タスク**: コマンド実行時の環境設定機能を実装する
- **成果物**: TerminalExecutor の拡張
  - 環境変数の設定
  - cwd パラメータの処理
  - PATH の解決
- **依存関係**: Day 117
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] 環境変数が正しく設定されること
  - [ ] 作業ディレクトリが変更できること
  - [ ] 単体テストが作成されていること

---

#### Day 119: シェルスクリプトの実行
- **タスク**: シェルスクリプトファイルを実行する機能を実装する
- **成果物**: TerminalExecutor の拡張
  - スクリプトファイルの検出
  - 適切なシェルの選択（bash, sh, powershell等）
  - スクリプト実行
- **依存関係**: Day 118
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] bash スクリプトが実行できること
  - [ ] PowerShell スクリプトが実行できること（Windows）
  - [ ] 単体テストが作成されていること

---

#### Day 120: Phase 5 総合テストとベンチマーク
- **タスク**: Phase 5の完了確認とパフォーマンスベンチマーク
- **成果物**:
  - `tests/performance/terminal-build-perf.test.ts`
  - Phase 5完了レポート
  - パフォーマンスベンチマーク結果
- **依存関係**: Day 119
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] すべてのターミナル・ビルド機能が動作すること
  - [ ] コマンド実行のオーバーヘッドが最小限であること
  - [ ] テストカバレッジが90%以上であること

---

### Week 5: ドキュメント整備とリファクタリング（5日間）

#### Day 121: ターミナル・ビルドAPIドキュメントの作成
- **タスク**: ターミナルとビルドのAPIドキュメントを作成する
- **成果物**: `docs/api/terminal-build.md`
  - execute_command API仕様
  - execute_build API仕様
  - サポートされるビルドツール一覧
  - エラーコード一覧
  - サンプルコード
- **依存関係**: Day 120
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] すべてのAPIが文書化されていること
  - [ ] サンプルコードが動作すること

---

#### Day 122: ユーザーガイドの作成
- **タスク**: ターミナルとビルドのユーザーガイドを作成する
- **成果物**: `docs/user-guide/terminal-build.md`
  - コマンド実行の使い方
  - ビルドの実行方法
  - エラーの読み方
  - トラブルシューティング
- **依存関係**: Day 121
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] 初心者でも理解できる内容であること
  - [ ] 実用的な例が含まれていること

---

#### Day 123: エラーハンドリングの改善
- **タスク**: ターミナル・ビルドのエラーハンドリングを見直す
- **成果物**:
  - より詳細なエラーメッセージ
  - リトライ戦略の実装
  - エラーリカバリー機能
- **依存関係**: Day 122
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] エラーメッセージが明確であること
  - [ ] リトライが適切に動作すること

---

#### Day 124: コードレビューとリファクタリング
- **タスク**: Phase 5のコード全体をレビューしリファクタリングする
- **成果物**:
  - コードレビューレポート
  - リファクタリング実施
  - コード品質の向上
- **依存関係**: Day 123
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] Lintエラーがないこと
  - [ ] コードの可読性が向上していること

---

#### Day 125: Phase 5 最終レビューと完了確認
- **タスク**: Phase 5の完全性を確認し、次フェーズへの準備を行う
- **成果物**:
  - Phase 5最終レポート
  - Phase 6への引き継ぎ事項
- **依存関係**: Day 124
- **所要時間**: 1日
- **受け入れ基準**:
  - [ ] すべての機能が完成していること
  - [ ] すべてのテストがパスすること
  - [ ] ドキュメントが整備されていること

---

## Phase 5 完了基準

- [ ] execute_command ツールが完全に実装されている
- [ ] execute_build ツールが完全に実装されている
- [ ] すべての主要ビルドツールがサポートされている
- [ ] ビルドログ解析が動作している
- [ ] タイムアウト機能が動作している
- [ ] バックグラウンド実行が動作している
- [ ] プロセス管理が実装されている
- [ ] 環境変数・ワークディレクトリ設定が動作している
- [ ] 単体テストカバレッジが90%以上
- [ ] 統合テストがすべてパスする
- [ ] APIドキュメントとユーザーガイドが完成している

---

## Phase 5 成果物サマリー

| カテゴリ | 成果物 | 完了 |
|---------|--------|------|
| ターミナル | execute_command, プロセス管理 | ☐ |
| ビルド | execute_build, ビルドツール検出 | ☐ |
| ログ解析 | BuildLogParser (npm/Maven/Gradle/MSBuild対応) | ☐ |
| プロセス管理 | プロセス一覧、終了、ストリーミング出力 | ☐ |
| 環境設定 | 環境変数、ワークディレクトリ | ☐ |
| テスト | 単体テスト、統合テスト、パフォーマンステスト | ☐ |
| ドキュメント | APIドキュメント、ユーザーガイド | ☐ |

---

**前のフェーズ**: [Phase 4: コード編集機能実装](./phase-4-code-editing.md)
**次のフェーズ**: [Phase 6: 診断・修正機能実装](./phase-6-diagnostics.md)
